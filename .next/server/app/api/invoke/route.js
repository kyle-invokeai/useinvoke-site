"use strict";(()=>{var e={};e.id=420,e.ids=[420],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7493:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>w});var s={};r.r(s),r.d(s,{POST:()=>c});var a=r(5419),o=r(9108),n=r(9678),i=r(8070),l=r(8234);let u=`Perfect. Last one — what are you most excited to invoke? Reply with a number:
1 Tasks
2 Reminders
3 Planning
4 Money
5 Coordination
6 Something else`,p=`You're on the early list. We're launching soon — I'll text you when your spot opens. You can //invoke here anytime for updates.`;async function c(e){try{let{from:t,body:r,channel:s="web"}=await e.json();if(!t||!r)return i.Z.json({error:"Phone number (from) and message body are required"},{status:400});let a=t.trim();a.startsWith("+")||(a="+1"+a.replace(/\D/g,"")),await l.O.from("messages").insert([{phone:a,direction:"inbound",body:r,channel:s}]);let{data:o}=await l.O.from("conversations").select("state").eq("phone",a).single(),n=o?.state||{step:"greeting"},{data:c}=await l.O.from("waitlist_users").select("id, interest_category").eq("phone",a).single(),d=function(e,t={step:"greeting"}){let r=e.trim().toLowerCase(),s=r.includes("//invoke")||r.includes("hello")||r.includes("hi")||r.includes("start")||r.includes("invoke");if(s||"greeting"===t.step)return{reply:u,state:{step:"awaiting_category",lastMessageAt:new Date().toISOString()}};if("awaiting_category"===t.step){let e=parseInt(r.replace(/[^0-9]/g,""),10);return e>=1&&e<=6?{reply:p,state:{step:"completed",lastMessageAt:new Date().toISOString()},category:e}:{reply:`Please reply with a number 1-6 to let us know what you're most interested in:
1 Tasks
2 Reminders
3 Planning
4 Money
5 Coordination
6 Something else`,state:{step:"awaiting_category",lastMessageAt:new Date().toISOString()}}}return"completed"===t.step?s?{reply:u,state:{step:"awaiting_category",lastMessageAt:new Date().toISOString()}}:{reply:'Thanks for reaching out! You\'re on the early list. Reply "//invoke" anytime for updates or to change your preferences.',state:{step:"completed",lastMessageAt:new Date().toISOString()}}:{reply:'Hi there! Reply "//invoke" to get started or reply with a number 1-6 if you\'re selecting your interest.',state:t}}(r,n);return d.category&&c&&await l.O.from("waitlist_users").update({interest_category:d.category}).eq("phone",a),!c&&function(e){let t=e.trim().toLowerCase();return t.includes("//invoke")||t.includes("hello")||t.includes("hi")||t.includes("start")||t.includes("invoke")}(r)&&await l.O.from("waitlist_users").insert([{phone:a,source:s,status:"waitlist"}]),await l.O.from("conversations").upsert({phone:a,state:d.state,updated_at:new Date().toISOString()},{onConflict:"phone"}),await l.O.from("messages").insert([{phone:a,direction:"outbound",body:d.reply,channel:s}]),i.Z.json({success:!0,reply:d.reply,state:d.state,category:d.category},{status:200})}catch(e){return console.error("Invoke API error:",e),i.Z.json({error:"Internal server error"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/invoke/route",pathname:"/api/invoke",filename:"route",bundlePath:"app/api/invoke/route"},resolvedPagePath:"C:\\Users\\kyleb\\OneDrive\\Desktop\\ai-agent-orchestrator\\app\\api\\invoke\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:h,headerHooks:m,staticGenerationBailout:w}=d,f="/api/invoke/route";function v(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},8234:(e,t,r)=>{r.d(t,{O:()=>n});var s=r(3950);let a="https://jstcydhqofpiiwkfkwsr.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY||"sb_publishable__uYOgER2nUn06E9nJl039A_5D97BvpW",n=a&&o?(0,s.eI)(a,o,{auth:{autoRefreshToken:!1,persistSession:!1}}):(0,s.eI)("https://placeholder.supabase.co","placeholder",{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,206,950],()=>r(7493));module.exports=s})();